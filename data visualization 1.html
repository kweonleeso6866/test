<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ëŸ¬ìŠ¤í„° ì‹œê°í™”</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .tooltip.active {
            opacity: 1;
        }
        .tooltip p {
            margin: 0;
        }
        .tooltip-title {
            font-weight: 500;
            font-size: 14px;
        }
        .tooltip-content {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
    </style>
</head>
<body class="bg-white">
    <div class="w-full min-h-screen p-6">
        <div class="max-w-7xl mx-auto flex flex-col" style="height: calc(100vh - 48px);">
            <div class="mb-4">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">í´ëŸ¬ìŠ¤í„° ì‹œê°í™”</h1>
                <p class="text-sm text-gray-600" id="stats">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </p>
            </div>
            
            <div class="flex-1 bg-white rounded-lg border border-gray-200 p-4" id="chart-container">
                <svg id="scatter-chart" width="100%" height="100%"></svg>
            </div>
            
            <div class="mt-4 grid grid-cols-6 gap-2" id="cluster-legend"></div>

            <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <h3 class="text-sm font-semibold text-blue-900 mb-2">ğŸ’¡ ì‹¤ì œ ë°ì´í„° ì ìš© ë°©ë²•</h3>
                <p class="text-xs text-blue-800 mb-2">
                    í˜„ì¬ëŠ” ìƒ˜í”Œ ë°ì´í„°ë¡œ ì‹œê°í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ë°ì´í„° í˜•ì‹:
                </p>
                <code class="block bg-white p-2 rounded text-xs text-gray-800 border border-blue-200">
                    [{ x: 10.5, y: -20.3, cluster: 0 }, ...]
                </code>
                <p class="text-xs text-blue-700 mt-2">
                    â€¢ x, y: ì¢Œí‘œê°’ (ìˆ«ì)<br />
                    â€¢ cluster: í´ëŸ¬ìŠ¤í„° ID (0ë¶€í„° ì‹œì‘í•˜ëŠ” ì •ìˆ˜)
                </p>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip">
        <p class="tooltip-title" id="tooltip-title"></p>
        <p class="tooltip-content" id="tooltip-content"></p>
    </div>

    <script>
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        const generateClusterData = () => {
            const clusters = [
                { id: 0, center: [-35, -15], count: 400, color: '#1e3a8a' },
                { id: 1, center: [-25, 25], count: 350, color: '#1e40af' },
                { id: 2, center: [-10, -25], count: 300, color: '#2563eb' },
                { id: 3, center: [-15, 25], count: 450, color: '#0891b2' },
                { id: 4, center: [0, 0], count: 500, color: '#7c2d12' },
                { id: 5, center: [10, 35], count: 600, color: '#1e3a5f' },
                { id: 6, center: [0, -25], count: 400, color: '#422006' },
                { id: 7, center: [10, -15], count: 350, color: '#134e4a' },
                { id: 8, center: [25, 15], count: 400, color: '#365314' },
                { id: 9, center: [30, 30], count: 450, color: '#4d7c0f' },
                { id: 10, center: [-5, -35], count: 300, color: '#92400e' },
            ];
            
            const allPoints = [];
            clusters.forEach(cluster => {
                for (let i = 0; i < cluster.count; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.random() * 8 + Math.random() * 4;
                    const x = cluster.center[0] + Math.cos(angle) * radius;
                    const y = cluster.center[1] + Math.sin(angle) * radius;
                    
                    allPoints.push({
                        x: x,
                        y: y,
                        cluster: cluster.id,
                        color: cluster.color,
                        value: cluster.id
                    });
                }
            });
            
            return { points: allPoints, clusters: clusters };
        };

        // ë°ì´í„° ìƒì„±
        const { points: data, clusters } = generateClusterData();

        // í´ëŸ¬ìŠ¤í„° í†µê³„ ê³„ì‚°
        const clusterStats = data.reduce((acc, point) => {
            acc[point.cluster] = (acc[point.cluster] || 0) + 1;
            return acc;
        }, {});

        // í†µê³„ ì—…ë°ì´íŠ¸
        document.getElementById('stats').textContent = 
            `ì´ ${data.length.toLocaleString()}ê°œ ë°ì´í„° í¬ì¸íŠ¸, ${Object.keys(clusterStats).length}ê°œ í´ëŸ¬ìŠ¤í„°`;

        // ì°¨íŠ¸ ì„¤ì •
        const margin = { top: 20, right: 80, bottom: 60, left: 60 };
        const container = d3.select('#chart-container');
        const containerRect = container.node().getBoundingClientRect();
        const width = containerRect.width - margin.left - margin.right;
        const height = containerRect.height - margin.top - margin.bottom;

        // SVG ì„¤ì •
        const svg = d3.select('#scatter-chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom);

        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        // ìŠ¤ì¼€ì¼ ì„¤ì •
        const xScale = d3.scaleLinear()
            .domain([-50, 50])
            .range([0, width]);

        const yScale = d3.scaleLinear()
            .domain([-50, 50])
            .range([height, 0]);

        // ì¶• ì„¤ì •
        const xAxis = d3.axisBottom(xScale).ticks(10);
        const yAxis = d3.axisLeft(yScale).ticks(10);

        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(xAxis)
            .selectAll('text')
            .style('font-size', '12px');

        g.append('g')
            .call(yAxis)
            .selectAll('text')
            .style('font-size', '12px');

        // í˜¸ë²„ ìƒíƒœ ê´€ë¦¬
        let hoveredCluster = null;
        const tooltip = d3.select('#tooltip');

        // í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
        const dots = g.selectAll('.dot')
            .data(data)
            .enter()
            .append('circle')
            .attr('class', 'dot')
            .attr('cx', d => xScale(d.x))
            .attr('cy', d => yScale(d.y))
            .attr('r', 2.5)
            .attr('fill', d => d.color)
            .attr('fill-opacity', 0.7)
            .attr('stroke', 'none')
            .attr('cursor', 'pointer')
            .on('mouseenter', function(event, d) {
                hoveredCluster = d.cluster;
                updateDots();
                
                tooltip
                    .classed('active', true)
                    .html(`<p class="tooltip-title">í´ëŸ¬ìŠ¤í„° ${d.cluster}</p>
                           <p class="tooltip-content">X: ${d.x.toFixed(2)}, Y: ${d.y.toFixed(2)}</p>`);
            })
            .on('mousemove', function(event) {
                tooltip
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseleave', function() {
                hoveredCluster = null;
                updateDots();
                tooltip.classed('active', false);
            });

        // ì  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDots() {
            dots
                .attr('r', d => hoveredCluster === d.cluster ? 4 : 2.5)
                .attr('fill-opacity', d => hoveredCluster === d.cluster ? 1 : 0.7)
                .attr('stroke', d => hoveredCluster === d.cluster ? '#ffffff' : 'none')
                .attr('stroke-width', d => hoveredCluster === d.cluster ? 1 : 0);
        }

        // ë²”ë¡€ ìƒì„±
        const legendContainer = d3.select('#cluster-legend');
        const legendItems = Object.keys(clusterStats).map(id => parseInt(id));

        legendItems.forEach(clusterId => {
            const clusterData = clusters.find(c => c.id === clusterId);
            const item = legendContainer
                .append('div')
                .attr('class', 'p-2 rounded border border-gray-200 cursor-pointer transition-all')
                .on('mouseenter', function() {
                    hoveredCluster = clusterId;
                    updateDots();
                    d3.select(this)
                        .classed('border-gray-200', false)
                        .classed('border-gray-800', true)
                        .classed('shadow-md', true);
                })
                .on('mouseleave', function() {
                    hoveredCluster = null;
                    updateDots();
                    d3.select(this)
                        .classed('border-gray-800', false)
                        .classed('shadow-md', false)
                        .classed('border-gray-200', true);
                });

            const content = item.append('div').attr('class', 'flex items-center gap-2');
            
            content.append('div')
                .attr('class', 'w-4 h-4 rounded')
                .style('background-color', clusterData.color);

            const textDiv = content.append('div');
            textDiv.append('p')
                .attr('class', 'text-xs font-medium')
                .text(`í´ëŸ¬ìŠ¤í„° ${clusterId}`);
            textDiv.append('p')
                .attr('class', 'text-xs text-gray-600')
                .text(`${clusterStats[clusterId]}ê°œ`);
        });

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
        function resizeChart() {
            const containerRect = container.node().getBoundingClientRect();
            const newWidth = containerRect.width - margin.left - margin.right;
            const newHeight = containerRect.height - margin.top - margin.bottom;

            xScale.range([0, newWidth]);
            yScale.range([newHeight, 0]);

            svg.attr('width', newWidth + margin.left + margin.right)
               .attr('height', newHeight + margin.top + margin.bottom);

            g.select('.x-axis').remove();
            g.select('.y-axis').remove();

            g.append('g')
                .attr('class', 'x-axis')
                .attr('transform', `translate(0,${newHeight})`)
                .call(xAxis)
                .selectAll('text')
                .style('font-size', '12px');

            g.append('g')
                .attr('class', 'y-axis')
                .call(yAxis)
                .selectAll('text')
                .style('font-size', '12px');

            dots
                .attr('cx', d => xScale(d.x))
                .attr('cy', d => yScale(d.y));
        }

        window.addEventListener('resize', resizeChart);
    </script>
</body>
</html>

